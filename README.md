# Byte researcher

Скрипт по исследованию payload'ов в TCP/UDP из .pcap(ng) дампов.
Производит два типа анализа: позиционный и пакетно-позиционный.

Результаты выполнения скрипта следует использовать для более точного написания RegExp выражений. 

## Позиционный метод
Суть метода заключается в частотном анализе байт paylod'ов, находящихся на одной позиции. В данном методе порядок paylod'ов не важен.

![pos method pic](https://github.com/Serj57/Researcher/blob/main/blob/pos_method.png)

В результате: 

| position | items |
| ----- | ----- |
| 1 | ('aa', 4)|
| 2 | ('ff', 4)|
| 3 | ('01', 2) ('ed', 2) |
| 4 | ('a0', 1) ('4b', 1) ('c7', 1) ('09', 1) |


## Пакетно-позиционный метод
В пакетно-позиционном методе мы сначала разделяем пакеты по потокам, основанным на [5-Tuple](https://www.ietf.org/rfc/rfc6146.txt).

![pkt-pos method pic](https://github.com/Serj57/Researcher/blob/main/blob/pkt_pos_method.png)

Пусть пакеты с номерами 1 и 3 относятся к 1-му потоку, а 2 и 4 ко 2-му потоку.

Затем из каждого потока берутся первые пакеты. В нашем случае это 1-й и 2-й. Относительно их применяется позиционный метод. Следующими берутся вторые пакеты потоков (3-й и 4-й) и снова применяется позиционный метод.

В результате:

| packet | position | items |
| ----- | ----- | ----- |
| 1 | 1 | ('aa', 2) |
| 1 | 2 | ('ff', 2) |
| 1 | 3 | ('01', 1) ('ed', 1)|
| 1 | 4 | ('a0', 1) ('4b', 1)|
| 2 | 1 | ('aa', 2) |
| 2 | 2 | ('ff', 2) |
| 2 | 3 | ('01', 1) ('ed', 1)|
| 2 | 4 | ('c7', 1) ('09', 1)|

## Установка
Для работы `researcher'a` необходим **tshark** и утилита командной строки для **sqlite3**.


Tshark устанавливается совместно с Wireshark как на Linux (из репозитория), так и Windows (с [официального сайта](https://www.wireshark.org/)).

Утилита командной строки sqlite3 для Windows доступна на официальном [сайте](https://www.sqlite.org/2022/sqlite-tools-win32-x86-3390400.zip). В Linux устанавливается из репозитория.


На Windows нужно в переменные окружения добавить пути до .exe файлов tshark и sqlite3.

Для форматирования вывода используется Python библиотека [prettytable](https://pypi.org/project/prettytable/).

Для ее установки нужно выполнить:
```bash
pip install prettytable
```

## Использование
Researcher поддерживает CLI.
Для получения описания основных аргументов используйте `-h`.
```bash
usage: Researcher [-h] {analize,pcap} ...

positional arguments:
  {analize,pcap}
    analize       Параметры анализа pcap(ng) файлов.  
    pcap          Параметры обработки pcap(ng) файлов.

options:
  -h, --help      show this help message and exit
```

Подробное описание аргументов доступно через -h:

```bash
python main.py <argument> -h
```

Обработка дампа выполняется поэтапно. Сначала его необходимо распарсить, а затем анализировать полученные данные.

Количество пакетов в дампе может быть различным, а в потоках не все пакеты могут быть нужны для анализа. Вы можете управлять количеством отображаемоей информации через параметры:

- `range` - число исследуемых позиций в payload'е;
- `length` - число отображаемых вариантов на одну позицию;
- `count` - число пакетов (актуально для пакетно-позиционного метода)

Пример вывода для позиционного анализа

| pos | open % | items |
| ----- | ----- | ----- |
| 1 | 100.0 | ('40', 13890) ('00', 215) ('01', 214) |
| 2 | 77.8  | ('00', 13890) ('01', 272) ('08', 56) ('03', 36) ('04', 36) ('13', 12) ('16', 7) |

Колонка `open` в процентах показывает количество отображенных элементов. Управляя параметрами, указанными выше, вы можете изменить область видимости.
